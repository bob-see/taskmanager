datasource db {
  provider = "sqlite"
}

generator client {
  provider = "prisma-client-js"
  engineType = "binary"
}

model Task {
  id               String   @id @default(cuid())
  title            String
  notes            String?
  dueAt            DateTime?
  completedAt      DateTime?
  completedOn      DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  startDate        DateTime @default(now())
  category         String?
  profileId        String   @default("default")
  projectId        String?
  recurrenceSeriesId String?
  repeatEnabled    Boolean  @default(false)
  repeatPattern    String?
  repeatDays       Int?
  repeatWeeklyDay  Int?
  repeatMonthlyDay Int?

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@index([profileId, startDate])
  @@index([profileId, dueAt])
  @@index([profileId, completedOn])
  @@index([profileId, recurrenceSeriesId])
  @@index([projectId])
  @@unique([profileId, recurrenceSeriesId, startDate])
}

model Profile {
  id            String    @id @default(cuid())
  name          String
  order         Int
  defaultView   String?
  averageBasis  String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tasks         Task[]
  projects      Project[]
}

model Project {
  id        String    @id @default(cuid())
  name      String
  startDate DateTime  @default(now())
  dueAt     DateTime?
  category  String?
  archived  Boolean   @default(false)
  collapsed Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  profileId String

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  tasks   Task[]

  @@index([profileId, createdAt])
}
